"""Specialist Agent #3."""
search_service = use("mcp", url="https://demo.mcp.aitomatic.com/websearch_v2")

# Agent Card declaration
agent FlightTicketAgent:
    name : str = "Flight Ticket Agent"
    description : str = "Agent that can find the best tickets for a flight"
    resources : list = [search_service]

# Agent's plan
def plan(ticket_agent : FlightTicketAgent, request : str):
    return {"plan": reason(f"Create a plan to find the best tickets based on the following request: {request}"), "request": request}

# This doesn't bind to the agent, it's a standalone function
def execute(data):
    request = data["request"]
    plan = data["plan"]
    qualified = False
    result = ""

    while qualified == False:
        answer = reason(f"Your goal is to find the best tickets for this request: {request}. This is the current plan : {plan} and the current result is : {result}. Follow the plan, execute what is missing and return the result.")
        qualified : bool = reason(f"Is the result qualified this request? Answer : {answer}. Return only 'True' or 'False'.")
        result = answer
        print(result)
    return result

# Agent's problem solver
def solve(ticket_agent : FlightTicketAgent, request : str):
    data = ticket_agent.plan(request)
    return execute(data)

# quick test:
# solve("Find the best tickets for a flight from San Francisco to Tokyo on June 26th 2025")
