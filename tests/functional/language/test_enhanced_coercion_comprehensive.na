# Comprehensive Enhanced Coercion System Tests
# Tests the improved behavior after removing the old type coercion system
# These tests verify expected behavior and will catch regressions

log("ðŸ§ª === ENHANCED COERCION SYSTEM TESTS ===")

# Test 1: Float to Int Coercion (NOW WORKS!)
log("ðŸ“‹ Test 1: Float to Int Coercion")

x: int = 3.9832958235
assert x == 3  # Should truncate, not round
log(f"âœ… float 3.98... â†’ int {x}")

y: int = 42.0  
assert y == 42
log(f"âœ… float 42.0 â†’ int {y}")

z: int = -7.9
assert z == -7  # Negative truncation
log(f"âœ… float -7.9 â†’ int {z}")

log("---")

# Test 2: Enhanced Boolean Coercion (SEMANTIC UNDERSTANDING)
log("ðŸ“‹ Test 2: Enhanced Boolean Coercion")

# Zero representations should be False (semantic)
zero_str: bool = "0"
assert zero_str == False
log(f"âœ… '0' â†’ {zero_str}")

zero_decimal: bool = "0.0"
assert zero_decimal == False  
log(f"âœ… '0.0' â†’ {zero_decimal}")

false_str: bool = "false"
assert false_str == False
log(f"âœ… 'false' â†’ {false_str}")

# Conversational patterns
no_way: bool = "no way"
assert no_way == False
log(f"âœ… 'no way' â†’ {no_way}")

yes_please: bool = "yes please"
assert yes_please == True
log(f"âœ… 'yes please' â†’ {yes_please}")

nope: bool = "nope"
assert nope == False
log(f"âœ… 'nope' â†’ {nope}")

log("---")

# Test 3: String to Type Assignments (NOW WORK!)
log("ðŸ“‹ Test 3: String to Type Assignments")

decision: bool = "1"
assert decision == True
log(f"âœ… bool assignment: '1' â†’ {decision}")

count: int = "5"
assert count == 5
log(f"âœ… int assignment: '5' â†’ {count}")

temp: float = "98.6"
assert temp == 98.6
log(f"âœ… float assignment: '98.6' â†’ {temp}")

log("---")

# Test 4: Bool to String Conversion (Lowercase)
log("ðŸ“‹ Test 4: Bool to String Conversion")

true_str: str = True
assert true_str == "true"
log(f"âœ… True â†’ '{true_str}'")

false_str: str = False
assert false_str == "false"
log(f"âœ… False â†’ '{false_str}'")

log("---")

# Test 5: Semantic Equivalence (ENHANCED)
log("ðŸ“‹ Test 5: Semantic Equivalence")

# These should work with semantic comparison
result1 = ("0" == False)  # Should be True with semantic equals
result2 = ("1" == True)   # Should be True with semantic equals

log(f"'0' == False: {result1}")
log(f"'1' == True: {result2}")

log("---")

# Test 6: POET-Enhanced Reason Function
log("ðŸ“‹ Test 6: POET-Enhanced Reason Function")

# Boolean context
decision_bool: bool = reason("Should we proceed with this test?")
log(f"âœ… Boolean reason: {decision_bool} (type: {type(decision_bool)})")

# Integer context  
count_int: int = reason("How many planets are in our solar system?")
log(f"âœ… Integer reason: {count_int} (type: {type(count_int)})")

# Float context
pi_float: float = reason("What is the value of pi?")
log(f"âœ… Float reason: {pi_float} (type: {type(pi_float)})")

# String context (detailed)
explanation: str = reason("Explain why the sky is blue.")
log(f"âœ… String reason: {explanation[:50]}... (type: {type(explanation)})")

# Dict context (JSON)
planet_info: dict = reason("Give me information about Mars including diameter and distance from Earth.")
log(f"âœ… Dict reason: {planet_info} (type: {type(planet_info)})")

# List context (JSON array)
planets: list = reason("List the first 4 planets from the sun.")
log(f"âœ… List reason: {planets} (type: {type(planets)})")

log("---")

# Test 7: Complex Mixed Type Operations
log("ðŸ“‹ Test 7: Complex Mixed Type Operations")

# Verify everything works together
mixed_result: float = 3.14 + int("2") + float("1.5")
assert abs(mixed_result - 6.64) < 0.0001  # Use approximate equality for floating point
log(f"âœ… Mixed operations: 3.14 + int('2') + float('1.5') = {mixed_result}")

# String building with coercion
total: int = 42
message: str = "Count: " + str(total)
log(f"âœ… String building: '{message}'")

log("---")

log("ðŸŽ‰ === ALL ENHANCED COERCION TESTS PASSED ===")
log("âœ… Float to int coercion working")
log("âœ… Semantic boolean understanding working") 
log("âœ… String to type assignments working")
log("âœ… Bool to string conversion working")
log("âœ… POET-enhanced context-aware reasoning working")
log("âœ… Mixed type operations working")
log("")
log("ðŸš€ Enhanced coercion system is fully functional!")
log("ðŸ›¡ï¸ These tests will catch any regressions to the old inferior behavior.") 